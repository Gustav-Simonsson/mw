New Contract API
===============================

![alt tag](../master/priv/blade_runner/intro.gif?raw=true)

### Documentation

http://docs.gustavsimonsson.apiary.io/

(ping Gustav for read / edit access rights)

## Curl examples:

### Clone contract
``` bash
10:19:42 batman ~/projects/mw> curl -H "Accept: application/json" -H "Content-type: application/json" "http://127.0.0.1:8082/clone-contract/1"
{"new_contract_id":15}10:19:45 batman ~/projects/mw> 

```

### Enter contract

``` bash
11:38:54 batman ~/projects/mw> curl -H "Accept: application/json" -H "Content-type: application/json" "http://127.0.0.1:8082/enter-contract/15?ec_pubkey=7FBCEaBkDBCVPXyTybqZDCjtcvMQmgZqNCqQAVps6P5SM4nZEZ&rsa_pubkey=LS0tLS1CRUdJTiBQVUJMSUMgS0VZLS0tLS0KTUlJQklUQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FRNEFNSUlCQ1FLQ0FRQitDdkdnTzFSWU9keXR0WUh5QmU3eQp4M3B2UmZDa29zNHlPNWJQbkdHTlVVaDFsL3JnSXlPb0ZVR0QzRG5TRm55VHB5M3lDVCtqbC84Y202a0lDdDRqCjQ1VzBjZy81NlRTSnc3UGZOVGNidXExdGs2bnFGajJCR0lPQXVldUxHQ3VzRXFzREpZYnQwYjFCRkxKOHozSDYKeXhxQlZxTXc0YXJOSWtpTnh3d3NUL25GUnExNTVtYnMrOW0vWGg5dXltSy9ROW0rWWttdzYyUDhqNnFrczRaNwo2ekxXVWo1Mm5RWFN1Lzl0eTIzR2RKZkJFYzFtSFoxa1RSQmNGSHlvR1ovYWVURFdtNnFrS0U2NE15VnVEUE9aClh2VVNXUWFyUEYxSldvVjBlaTNUL3Z1bzRNa3pUSzJ3bjVFMHFEZGQ2dndHRmJZV0F2WTBUQTRiR1RDemxhcWIKQWdNQkFBRT0KLS0tLS1FTkQgUFVCTElDIEtFWS0tLS0t"
{"success-message":"ok"}11:39:09 batman ~/projects/mw> 

```

### Handled / expected errors (something non-successful happened for which we have a specific error code)
``` bash
11:50:36 batman ~/projects/mw> curl -H "Accept: application/json" -H "Content-type: application/json" "http://127.0.0.1:8082/enter-contract/15?ec_pubkey=7FBCEaBkDBCVPXyTybqZDCjtcvMQmgZqNCqQAVps6P5SM4nZEZ&rsa_pubkey=12"
{"error-code":22,"error-message":"rsa pubkey is not pem encoded"}11:50:36 batman ~/projects/mw> 

```

### UnHandled / unexpected errors (something exploded in backend)
``` bash
10:21:54 batman ~/projects/mw> curl -H "Accept: application/json" -H "Content-type: application/json" "http://127.0.0.1:8082/get-contract-state/15"
{"error-code":0,"error-message":"Something is on fire. Don't panic. Blame Gustav."}10:23:17 batman ~/projects/mw> 

```

### Get contract info (no T2 available for signing yet)
``` bash
11:35:39 batman ~/projects/mw> curl -H "Accept: application/json" -H "Content-type: application/json" "http://127.0.0.1:8082/get-contract-state/15"
{"match_no":null,"headline":"Brazil 0:2 Croatia","desc":"group stage game #1 Brazil vs Croatia 6/12/2014 ","outcome":null,"event_pubkey":"7xkQihdPnqwsqSBBPyJd6nFGm8t8gLe5XvZFwRJXamZYCMyYfD","giver_ec_pubkey":null,"taker_ec_pubkey":null,"giver_enc_ec_privkey":null,"taker_enc_ec_privkey":null,"giver_enc_rsa_privkey":null,"taker_enc_rsa_privkey":null,"event_key_enc_with_oracle_yes_and_giver_keys":null,"event_key_enc_with_oracle_no_and_taker_keys":null,"t2_sighash_input_0":null,"t2_sighash_input_1":null,"t2_hash":null,"t2_raw":null,"history":[{"timestamp":"2014-09-28T08:19:45Z","event":"Contract cloned."}]}11:35:45 batman ~/projects/mw> 
```

### Get contract info (T2 available for signing)
``` bash
16:40:48 batman ~/projects/mw/priv/test_keys/taker_keys1> curl -H "Accept: application/json" -H "Content-type: application/json" "http://127.0.0.1:8082/get-contract-state/1"
{"match_no":null,"headline":"Croatia beat Brazil","desc":"group stage game #1 Brazil vs Croatia 6/12/2014 ","outcome":null,"event_pubkey":"8aUm4ptxxR5cdBmNJCeqsnZ8RF3LESstdbwEKa8UueD1rjSQB4","giver_ec_pubkey":"7tNQaqcKENb3AVm4Mprp7yXqiYHuQvo62Nk1N8hmVHbpb54k6J","taker_ec_pubkey":"5UpmYgS15gpL1uPg3TgSfEBdfSQD5pw2XrEcKFm4yY8bUm4GQ5","giver_enc_ec_privkey":"","taker_enc_ec_privkey":"","giver_enc_rsa_privkey":"","taker_enc_rsa_privkey":"","event_key_enc_with_oracle_yes_and_giver_keys":"A1EFFEC100000000BCB87BF0861497E5B84900B9EF772B5366D1AC66C060F80ED37352BBC3EC4F681D10DEAB895B1FA44204EA26C57DDB74D6897EAD4C486ABA3D2BE54AA40A09F3F2C6270A58CCC5186A75E78A5B2B9269DD1BC105804247D70BD65C8C2D38C58141A4CDA3A942FA815E9D4E9EC90C7A3B1559A3625AD39724E3641A425AADA018EB2B9AF2EBA96096CF59FC6A28DA9B9EAF038AA13CA7DB485D3C6E6FC3B9F6146DED51683A4A35EDE48182848217358D6F4089FD5F9D09737F013E86D29F5AFDA6EF9BF3984904575BD32C89CC382894FE8712888C696A57E0F112E94EE659DD0431E76C3231CCB299D32E6777FC43370301AD54F0D45F73B90BA0C074EDE293BAE95A2B40EAB3A3BB8039F5745CCD6EE26762AC9F7F036A35F2BD8DA4DEA6D254A55BAEA6212E0855609D3691DF3817EE7CD932F63ABCC3B3DE408A376A18A64A5C91E2F011513F275802C859B20990103E9697FBB5BF6FA4B368BCA17AF0E1EC94B09DC6EBA769D7620075EABB0C4D14FB21BB8D10B8F499E7B613D04467ED47F36482F26086B5C167184E15DEF03143AA8CDF8B6C5C46DCEA19573AAB5AE0AEAE979C6F78E79813931FA7714E150E6E810804248807B8BE78894A2B6A1BC6084D27F351944699E5651BD29585DA9B75F60E611DAA4B89E827BC3771210182ED1B021CEF23A33531BADE6CC07BFBE7A14BB348AC0D384EA8D11522A43AA01F11FFE42D2A601AFA0233EF78330E9CBD9BF5D1FA791D9A031E2DF638A31F0D3A99C54FDA9EE68C82DB88FB390AE0BB5F7F71E322CE4C9BAD09E3C9EC1AEA0FC231ABB23A06FEB1B4367C846B28324F32","event_key_enc_with_oracle_no_and_taker_keys":"A1EFFEC1000000007C0D26D150A2742B95765BE3BA46C9B08B1CCB9FAB02A7B1B664B3B8A50E61017939A53D6267C3F8D8A5AE715BCA6F6C4F6BF55797240D65B42B3D74DFD20CA63F1323AC70B3D22ADB9446F0C60131B074C5EFD8F2ED7F09FB68EE24AB90BA6F334CB70C905F47C4C52B1FC7DF156C836FBB455B3BF13E203D8957DC4D1DA7C5B481FF64A6161E1E2E889BD3A5D9F50F78258B6D33D28AB477FF722FCB02B3AE973B202D9A2DAB41537627A5887C27F178796F6418F55D4E7B1C82F67169C73A1435843A950B8274FB16ED9E34A53975ECE125BAF2ED20E4DAD6C5855991304429D89A20B6BEC5FC6C30532E46A9BC309E2E822ED963F71F9F1E5EBA3A792D51CBC5E3B9E42B3CB038BAC1DB980338B5C87A7F9A8E7B59CC1A480BDC89D7D46F98C536F85C7BE972186F7D02B14DB42A6B73BE985878E3526C1C08E961E54260E2F80F812F53D9DFF9FEA020E777E57C73A8F9AE783BAA8D7344CA3B594F2B3B473288C6FD5B6AB06A49C57574814F196778D89489AF537C4B008C3A53CE8271D9FFD8247693FB8BA37AEF53E05820CEB659FCEA32DB6ADAC3DC3B5DB923FE814B8E23CC817ACB1B705070FA78DC763DA8DC6B67CD6D9C29677547AA9E4B5A1FAF9D2407E60152BE2E1FBD7045DFA1925B2AE13E852973BEDA0DD32A79106C57300A2369030252081B697DDF4B3062CE1D69F50116345D5733E83D3B74D0288CEE7702B211E757DADCF7175F92D88919CF9330F2BC23E0BFE2F57080DAACFFB9A9B518C5636FF701E97F749C6E128366C60F26446F3B5DC8C943AE46E7A106285FD3AE1D0CC6BB21DAE31708340AF3F3","t2_sighash_input_0":"BC1FBCD4918735A15077A7245AF946FFFA9DC5BECE2606DD7819CE6B3DE43082","t2_sighash_input_1":"9DA94C792BFAE66908C41EA507982E800061307E7C4848604990570293330529","t2_hash":"","t2_raw":"010000000259107A0A5FB5250E3E139266319D79AD02A84BE0F8387BC0E3025FE72FA28448000000001976A9142912837586088FF64ED6F5D9F792574891D3815588ACFFFFFFFFBC40F9955FB7C6100A1FBE26EC0A7B3CCCF31676788978F4A8CFFE74F14DBEBE000000001976A9144F3E49C5FEC6EE7CE02448A6B5240F997F17951688ACFFFFFFFF017011010000000000695221038AD0FC61705D4C85E41B8394F0CF169DCB5F938F015D96BA5E8431F63A552C1121024DF613C1FCBB5D6A4912D4D9F2DE6059094C798909C3694CCC31A0E6940480CB2103E5E3D4854102D378AFEE9D2AF0F93B70981E2FB00EFC7217ED2C10E4A39A3D6B53AE00000000","t3_raw":null,"history":[{"timestamp":"2014-09-28T13:54:11Z","event":"Contract created."},{"timestamp":"2014-09-28T13:54:11Z","event":"Giver entered contract."},{"timestamp":"2014-09-28T14:28:38Z","event":"Taker entered contract."},{"timestamp":"2014-09-28T14:37:06Z","event":"Giver sent T1."},{"timestamp":"2014-09-28T14:37:06Z","event":"Taker sent T1."}]}16:40:50 batman ~/projects/mw/priv/test_keys/taker_keys1> 
```

![alt tag](../master/priv/blade_runner/rachael2.jpg?raw=true)
